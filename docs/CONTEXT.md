# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: TG Market Parser

> –≠—Ç–æ—Ç —Ñ–∞–π–ª –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.

---

## –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞

–ü–∞—Ä—Å–µ—Ä —Ç–æ—Ä–≥–æ–≤–æ–≥–æ Telegram-—á–∞—Ç–∞ –∏–≥—Ä—ã **Epsilion War** ("–¢–æ—Ä–≥–æ–≤–ª—è. Epsilion War", ID: 1250973291).  
–¶–µ–ª—å ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **PHP 8.1+**, **Laravel 10**
- **MadelineProto** (danog/madelineproto ^8.0) ‚Äî –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Telegram
- **MySQL** ‚Äî –¥–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞: `telegram_parser` (–Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ) –∏ `telegram_session` (—Å–µ—Å—Å–∏–∏ MadelineProto)
- **Hetzner CX32** ‚Äî —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (32 CPU, 64GB RAM)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–∏ –ø—Ä–∏—á–∏–Ω—ã)

### –ü–æ—á–µ–º—É Laravel, –∞ –Ω–µ —á–∏—Å—Ç—ã–π PHP
MadelineProto —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è Composer-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞. –í—ã–±—Ä–∞–ª–∏ Laravel –∑–∞ –º–∏–≥—Ä–∞—Ü–∏–∏, Eloquent, Queue, Scheduling –∏ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. Artisan-–∫–æ–º–∞–Ω–¥–∞ `telegram:fetch` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ cron.

### –ü–æ—á–µ–º—É –¥–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MadelineProto —Å–æ–∑–¥–∞—ë—Ç —Å–≤–æ–∏ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–ª–∏ –∏—Ö –≤ `telegram_session`, —á—Ç–æ–±—ã –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å —Å –Ω–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ `telegram_parser`.

### –ü–æ—á–µ–º—É parent_id –≤ products, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
Self-referencing –ø—Ä–æ—â–µ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (`COALESCE(parent_id, id)`), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—à–∏—Ö –Ω—É–∂–¥. –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –±—ã–ª–∞ –±—ã –∏–∑–±—ã—Ç–æ—á–Ω–æ–π.

### –ü–æ—á–µ–º—É products –∏ services —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
–¢–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏ ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏. –°–º–µ—à–∏–≤–∞—Ç—å –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ = –∫–∞—à–∞ –≤ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç—á—ë—Ç–∞—Ö.

### –ü–æ—á–µ–º—É exchanges ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
–û–±–º–µ–Ω ‚Äî —ç—Ç–æ –¥–≤–µ —Å—Ç–æ—Ä–æ–Ω—ã (—Ç–æ–≤–∞—Ä –ê ‚Üî —Ç–æ–≤–∞—Ä –ë), –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–¥–µ–ª—å listings —Å –æ–¥–Ω–∏–º product_id. –ü–ª—é—Å –¥–æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º (–∫—Ç–æ –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—ã)

```
telegram_parser:
  tg_users          ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Ç–∞
  products          ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤ (parent_id –¥–ª—è –∞–ª–∏–∞—Å–æ–≤, icon –¥–ª—è –∏–∫–æ–Ω–æ–∫)
  services          ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É—Å–ª—É–≥ –∏ –Ω–∞–π–º–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ products)
  tg_messages       ‚Äî —Å—ã—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (raw_text, tg_link, sent_at, is_parsed)
  listings          ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏—è buy/sell —Ç–æ–≤–∞—Ä–æ–≤ (price, currency, status, anomaly_reason)
  service_listings  ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥/–Ω–∞–π–º–∞ (offer/wanted)
  exchanges         ‚Äî –æ–±–º–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞–º–∏ (product‚Üîexchange_product, surcharge)

telegram_session:
  [—Ç–∞–±–ª–∏—Ü—ã MadelineProto ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å]
```

---

## –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –¢–∏–ø—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏–∑ —Ö—ç—à—Ç–µ–≥–æ–≤ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤)

| –¢–∏–ø | –•—ç—à—Ç–µ–≥–∏ | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ |
|-----|---------|----------------|
| `sell` | #–ø—Ä–æ–¥–∞–º, #–ø—Ä–æ–¥–∞—é, #–ø—Ä–æ–¥–∞–∂–∞, #sell | –ø—Ä–æ–¥–∞–º, –ø—Ä–æ–¥–∞—é |
| `buy` | #–∫—É–ø–ª—é, #—Å–∫—É–ø–∫–∞, #—Å–∫—É–ø–ª—é, #—Å–∫—É–ø–∞—é, #buy, #–∏—â—É | –∫—É–ø–ª—é, –ø–æ–∫—É–ø–∞—é, —Å–∫—É–ø–∞—é |
| `trade` | #–æ–±–º–µ–Ω, #–æ–±–º–µ–Ω—è—é, #–º–µ–Ω—è—é, #–º–µ–Ω | –æ–±–º–µ–Ω—è—é, –º–µ–Ω—è—é |
| `service` | #—É—Å–ª—É–≥–∏, #—É—Å–ª—É–≥–∞, #–∫—Ä–∞—Ñ—Ç–µ—Ä, #–∞–ª—Ö–∏–º–∏–∫, #–∑–∞—Ç–æ—á–∫–∏, #–Ω–∞–π–º—É, #–Ω–∞–π–º | –ø—Ä–µ–¥–ª–∞–≥–∞—é —É—Å–ª—É–≥–∏ |

### –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—Ü–∏–π
–ù–∞–ø—Ä–∏–º–µ—Ä: `#–ø—Ä–æ–¥–∞–º ... #–∫—É–ø–ª—é ... #–æ–±–º–µ–Ω ...` ‚Äî –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ listings –∏ exchanges.

### –í–∞–ª—é—Ç—ã
- üí∞ = `gold` (–æ—Å–Ω–æ–≤–Ω–∞—è)
- üç™ = `cookie` (–≤—Ç–æ—Ä–∞—è)
- –¶–µ–Ω—ã —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ —á–∏—Å–ª–∞: `3 300üí∞` ‚Üí 3300

### –¢–æ–≤–∞—Ä—ã
- –ò–∫–æ–Ω–∫–∞ = —ç–º–æ–¥–∑–∏ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ: `üå°üéÜ`)
- –ù–∞–∑–≤–∞–Ω–∏–µ = —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∏–∫–æ–Ω–∫–∏ –¥–æ —Ç–∏—Ä–µ/—Ü–µ–Ω—ã
- –ü–æ–∏—Å–∫ –ø–æ `normalized_name` (–±–µ–∑ —ç–º–æ–¥–∑–∏, lowercase)
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å –≤ –ë–î —Å –∏–∫–æ–Ω–∫–æ–π, –∞ –≤ –Ω–æ–≤–æ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –±–µ–∑ –∏–∫–æ–Ω–∫–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –∏–∑ –ë–î

---

## –ê–Ω–æ–º–∞–ª–∏–∏ —Ü–µ–Ω

- –ü–æ—Ä–æ–≥: `PRICE_ANOMALY_THRESHOLD` –≤ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50%)
- –ü–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ: `PRICE_ANOMALY_DAYS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 –¥–Ω–µ–π)
- –ú–∏–Ω–∏–º—É–º –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞: 3 (–∏–Ω–∞—á–µ ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞—Ç—É—Å `ok`)
- –°—Ç–∞—Ç—É—Å—ã: `ok`, `suspicious`, `needs_review`, `invalid`
- `invalid` –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –≤—Å–µ—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ —Ü–µ–Ω

---

## API

`GET /api/market` ‚Äî —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `format=json|html`, `currency=gold|cookie`, `product_id=1,2,3`, `days=30`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ + –∫—Ç–æ –ø–æ–∫—É–ø–∞–µ—Ç (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å TG) + –¥–∞—Ç–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ + –∫—Ç–æ –ø—Ä–æ–¥–∞—ë—Ç + –¥–∞—Ç–∞

---

## –ß—Ç–æ –µ—â—ë –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

1. **–°–∏–¥–µ—Ä—ã —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏** ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –Ω–∞ –∏–º–µ—é—â–µ–º—Å—è JSON-—ç–∫—Å–ø–æ—Ä—Ç–µ, –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã/—Ü–µ–Ω—ã ‚Üí –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ CSV/—Å–∏–¥–µ—Ä—ã
2. **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç** ‚Äî `GET /api/market/report?date=2026-02-17`
3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞—Ç** ‚Äî `GET /api/market/compare?date1=...&date2=...`
4. **–ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω** ‚Äî `GET /api/market/history?product_id=5`
5. **–°–ø–∏—Å–æ–∫ –∞–Ω–æ–º–∞–ª–∏–π** ‚Äî `GET /api/market/anomalies`
6. **CSV —ç–∫—Å–ø–æ—Ä—Ç** –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (products, users, prices) –∏–∑ JSON-—ç–∫—Å–ø–æ—Ä—Ç–∞

---

## –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ò–º–µ–µ—Ç—Å—è JSON-—ç–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞: 31 521 —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ 2026-01-17 ‚Äî 2026-02-17.  
–§–æ—Ä–º–∞—Ç: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç Telegram Desktop (result.json).  
–ß–∞—Ç: "–¢–æ—Ä–≥–æ–≤–ª—è. Epsilion War", public_supergroup, ID: 1250973291.

---

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

```
app/Services/MessageParser.php          ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞
app/Services/MessageSaver.php           ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
app/Services/TelegramFetcher.php        ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ MadelineProto
app/Services/PriceAnomalyDetector.php   ‚Äî –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π
app/Http/Controllers/MarketController.php ‚Äî API
app/Console/Commands/FetchTelegramMessages.php ‚Äî Artisan –∫–æ–º–∞–Ω–¥–∞
config/parser.php                       ‚Äî –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
database/migrations/                    ‚Äî 7 –º–∏–≥—Ä–∞—Ü–∏–π
tests/Unit/MessageParserTest.php        ‚Äî —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
tests/Feature/MarketControllerTest.php  ‚Äî feature-—Ç–µ—Å—Ç—ã API
docs/README.md                          ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
docs/DATABASE.md                        ‚Äî —Å—Ö–µ–º–∞ –ë–î
docs/API.md                             ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
docs/CONTEXT.md                         ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ TODO

- [ ] MadelineProto `messages.getHistory` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∏–∫–µ offset_id
- [ ] –ü–∞—Ä—Å–µ—Ä –æ–±–º–µ–Ω–æ–≤ (`#–æ–±–º–µ–Ω`) –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω "–ú–æ–π X –Ω–∞ –≤–∞—à Y", –Ω–æ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –º–æ–≥—É—Ç –Ω–µ –ø–∞—Ä—Å–∏—Ç—å—Å—è
- [ ] –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–Ω ‚Üí –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è (–∂–¥—ë–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –º–∏–Ω–∏–º—É–º 3 –∑–∞–ø–∏—Å–µ–π)
- [ ] –°–∏–¥–µ—Ä—ã —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è MadelineProto –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–¥–∏–Ω —Ä–∞–∑)
